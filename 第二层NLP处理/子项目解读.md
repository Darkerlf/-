# 第二层NLP处理｜评论文本洞察（情感/方面/关键词/主题）子项目解读

> 说明：本文中出现的相对路径，默认以项目根目录 `E:\PycharmProjects\三创赛` 为基准。

## 1. 子项目定位（在全链路中的作用）

本层把“评论文本”转化为**可量化的消费者洞察特征**，并输出一组可直接放进项目书/PPT 的可视化图表。

- 上游：`第1层数据预处理/` 产出的清洗数据（产品维表 + 评论表 + 事实表）
- 下游：
  - `第三层预测建模/`（把情感与方面特征作为销量/爆款预测的解释变量）
  - `第五层聚类分析/`（把情感/方面特征纳入市场细分）
  - `知识图谱分析与关联层/`（把方面情感映射为 painpoint，生成图谱与关联规则）

---

## 2. 本层使用的数据（输入文件）

工作目录：`第二层NLP处理/`

- `reviews_cleaned.csv`：清洗后的评论表（含 `review_text_clean`、`review_rating`、`verified_purchase` 等）
- `fact_review_enriched.csv`：评论事实表（含产品维度）
- `products_clean.csv`：产品维表（价格、BSR、图片数、折扣、FBA 等）

当前目录数据规模（现有产物统计）：

- 评论：约 2218 条，其中 NLP 分析有效文本约 2216 条（见 `nlp_results/ANALYSIS_REPORT.md`）
- 产品：约 946 个

---

## 3. 核心脚本与技术点（逐文件解读）

### 3.1 `nlp_analysis_complete.py`（NLP 主流程）

输出目录：`nlp_results/`

**包含模块**：

1. **BERT 情感分析**
   - 技术：`transformers.pipeline` + `distilbert-base-uncased-finetuned-sst-2-english`
   - 输出：`nlp_results/data/bert_sentiment_results.csv`
   - 说明：每条评论得到 `bert_label(POSITIVE/NEGATIVE)` 与 `bert_score`

2. **ABSA（方面级情感分析）**
   - 技术：基于厨刀领域方面词典（如 sharpness/rust/handle/value…）进行匹配，并结合星级+BERT 简化判别正负
   - 输出：
     - `nlp_results/data/absa_detailed.csv`（每条评论命中某方面的记录）
     - `nlp_results/data/absa_summary.csv`（方面级汇总：提及次数、平均情感、提及率）

3. **TextRank 关键词**
   - 技术：TF-IDF → 句子相似度图 → PageRank（networkx）抽取关键词（TextRank 思路）
   - 输出：`nlp_results/data/textrank_keywords.csv`

4. **“NER”实体统计（品牌/材质）**
   - 技术：规则/词典/正则方式统计品牌与材质提及（用于竞品&材质偏好洞察）
   - 输出：`nlp_results/data/ner_brands.csv`、`nlp_results/data/ner_materials.csv`

5. **主题建模**
   - 技术：LDA/主题词汇汇总（脚本输出 top_words）
   - 输出：`nlp_results/data/topic_modeling.csv`

6. **基础可视化（8 张）**
   - 输出目录：`nlp_results/visualizations/`
   - 图表：
     - `1_bert_sentiment_distribution.png`（情感分布）
     - `2_sentiment_by_rating.png`（星级 vs 情感）
     - `3_absa_heatmap.png`（方面情感热力）
     - `4_absa_mention_rates.png`（方面提及率）
     - `5_textrank_keywords.png`（关键词 TopN）
     - `6_brand_mentions.png`（品牌提及 TopN）
     - `7_material_mentions.png`（材质提及 TopN）
     - `8_review_length_distribution.png`（评论长度分布）

7. **自动报告**
   - `nlp_results/analysis_summary.json`：结构化摘要（便于程序化引用）
   - `nlp_results/ANALYSIS_REPORT.md`：精简 Markdown 报告（可直接引用到项目书）

### 3.2 `advanced_visualizations.py`（高级可视化：比赛展示套图）

输出目录：`advanced_visualizations/`

生成 10 张“可直接上 PPT 的图”：

1. `01_wordclouds_4in1.png`：综合词云（整体/正面/负面/痛点）
2. `02_aspect_radar_chart.png`：方面情感雷达图（气泡大小=提及率）
3. `03_brand_heatmap.png`：品牌对比热力图（正面率/均分/置信度/评论量等）
4. `04_keyword_network.png`：关键词关联网络
5. `05_sentiment_flow.png`：评分-情感流向（绝对量+比例）
6. `06_topic_wordclouds.png`：主题词云
7. `07_aspect_bubble_chart.png`：方面气泡图（提及×情感）
8. `08_brand_boxplot.png`：品牌情感箱线图
9. `09_pain_points_funnel.png`：负面痛点漏斗（痛点优先级）
10. `10_comprehensive_dashboard.png`：综合仪表盘（8 合 1 总览）

并自动生成配套说明文档：`advanced_visualizations/图表说明文档.md`

---

## 4. 输出数据与图像怎么解读（项目书写法：按“图/表”给话术）

### 4.1 关键数据表（可作为后续建模/聚类特征）

- `bert_sentiment_results.csv`（review 粒度）
  - 字段含义：`bert_label`=正/负，`bert_score`=模型置信度
  - 写法：用“评论正负面占比”刻画类目口碑基调；用 `bert_score` 作为情绪强度/置信度信号

- `absa_summary.csv`（aspect 粒度）
  - 字段含义：`avg_sentiment`（-1~1）、`mention_rate`（提及率）
  - 写法：用“高提及 + 低情感”的方面定义为**核心痛点**；“高提及 + 高情感”为**核心卖点**

- `ner_brands.csv / ner_materials.csv`
  - 写法：用于“竞品/材质偏好”章节：头部品牌是谁、用户关注的材质是什么（steel/stainless/carbon/damascus…）

### 4.2 基础可视化（`nlp_results/visualizations/`）

你可以在项目书中逐图描述（模板）：

- `1_bert_sentiment_distribution.png`
  - 表达：类目口碑正负面结构（占比/数量）
  - 项目书句式：*“图X 展示了评论情感分布，整体以正面为主（约 69%），说明厨刀类目整体满意度较高，但仍存在约 31% 的负面反馈空间。”*

- `2_sentiment_by_rating.png`
  - 表达：星级与 BERT 情感一致性（验证模型合理性）
  - 句式：*“图X 显示低星（1-2星）评论以负面为主，高星（5星）几乎全为正面，说明情感模型与星级标签一致，可用于无星级场景的情绪识别。”*

- `3_absa_heatmap.png` + `4_absa_mention_rates.png`
  - 表达：方面“被讨论程度”与“好坏”两张图配合讲故事
  - 句式：*“图X 体现用户最关注锋利度（sharpness）等核心性能指标；而 rust 方面呈现更偏负向的情绪，提示防锈是主要痛点之一。”*

### 4.3 高级可视化套图（`advanced_visualizations/`）

本目录已经自带“可直接上 PPT 的解释文档”：

- `advanced_visualizations/图表说明文档.md`

项目书建议写法：把这 10 张图分成三段叙事：

1. **用户声音（词云/关键词网络/主题）**：用户在讨论什么
2. **产品强弱项（ABSA 雷达/气泡/痛点漏斗）**：买点与痛点
3. **竞品对比（品牌热力/箱线）**：头部品牌与差异化机会

---

## 5. 复现运行方式

在 `第二层NLP处理/` 下：

```bash
pip install -r requirements.txt

# 1) 先跑 NLP 主流程（产出 nlp_results/ 下的数据与基础图）
python nlp_analysis_complete.py

# 2) 再跑高级可视化（依赖 nlp_results/data/*）
python advanced_visualizations.py
```

---

## 6. 注意事项（项目书里建议如实说明）

- BERT 模型为通用英文情感模型（SST-2 微调），对“厨刀领域细粒度语义”可能存在偏差；本项目通过“星级一致性图（2_sentiment_by_rating）”进行有效性验证。
- ABSA 采用词典/规则简化方案，适合比赛快速落地；若要进一步学术化，可引入更专业的 ABSA 模型或人工标注小样本做校准。
